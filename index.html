<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的 Ballsdex 圖鑑</title>
    <!-- 引入 Tailwind CSS 讓樣式變漂亮 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 PapaParse 用來讀取 Google Sheets -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { background-color: #111827; color: white; }
        .card:hover { transform: translateY(-5px); border-color: #3b82f6; }
    </style>
</head>
<body class="p-6">
 
    <!-- 標題 -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-blue-500">Ballsdex 簡易圖鑑</h1>
        <p class="text-gray-400 mt-2">資料來源：Google 試算表</p>
    </div>
 
    <div class="flex flex-col md:flex-row gap-6 max-w-7xl mx-auto">
       
        <!-- 左側：搜尋與過濾 -->
        <div class="w-full md:w-1/4 bg-gray-800 p-4 rounded-lg h-fit border border-gray-700">
            <h2 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">篩選器</h2>
           
            <input type="text" id="searchInput" placeholder="搜尋名字..."
                   class="w-full p-2 mb-4 bg-gray-700 rounded text-white border border-gray-600 focus:outline-none focus:border-blue-500">
           
            <div id="tagFilters" class="space-y-2">
                <p class="text-gray-400 text-sm">點擊下方標籤過濾：</p>
                <!-- 標籤按鈕會由程式自動產生 -->
            </div>
           
            <button onclick="resetFilters()" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white py-1 rounded">
                重置篩選
            </button>
        </div>
 
        <!-- 右側：卡片列表 -->
        <div id="cardContainer" class="w-full md:w-3/4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <p class="text-gray-400">正在讀取資料...</p>
        </div>
    </div>
 
    <script>
        // ==========================================
        // 設定區：請把下面的網址換成你的 Google Sheet CSV 網址
        // ==========================================
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS3L8-yHh4d6Whg4WZiaE8J0Yp0jF6PMuZySx_H-EbbrDolzBveFku0pMSEz5c8-b_ez9sCmvhvInec/pub?output=csv';
        // 例如: https://docs.google.com/spreadsheets/d/e/2PACX-.../pub?output=csv
        // ==========================================
 
        let allBalls = [];
        let activeTag = '';
 
        // 1. 初始化：讀取 Google Sheet 資料
        window.onload = function() {
            if(SHEET_URL.includes('你的_GOOGLE')) {
                document.getElementById('cardContainer').innerHTML = '<p class="text-red-500">請編輯 HTML 檔案，填入正確的 Google Sheet 連結！</p>';
                return;
            }
 
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    allBalls = results.data.filter(item => item.Name); // 過濾空行
                    generateTags();
                    renderCards(allBalls);
                },
                error: function(err) {
                    console.error(err);
                    document.getElementById('cardContainer').innerHTML = '<p class="text-red-500">讀取失敗，請確認網址是否正確且已發布。</p>';
                }
            });
        };
 
        // 2. 顯示卡片
        function renderCards(data) {
            const container = document.getElementById('cardContainer');
            container.innerHTML = '';
 
            if (data.length === 0) {
                container.innerHTML = '<p class="text-gray-500">找不到符合的球。</p>';
                return;
            }
 
            data.forEach(ball => {
                // 處理標籤顯示
                const tagsHtml = ball.Tags ? ball.Tags.split(',').map(t =>
                    `<span class="text-xs bg-gray-700 px-2 py-1 rounded mr-1">${t.trim()}</span>`
                ).join('') : '';
 
                const card = `
                    <div class="card bg-gray-800 rounded-lg overflow-hidden border border-gray-700 transition duration-300">
                        <div class="h-40 bg-gray-900 flex items-center justify-center p-2">
                            <img src="${ball.Image}" alt="${ball.Name}" class="max-h-full max-w-full object-contain" onerror="this.src='https://placehold.co/100x100?text=No+Image'">
                        </div>
                        <div class="p-3">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-lg leading-tight text-white">${ball.Name}</h3>
                                <span class="text-xs font-mono text-yellow-500">#${ball.Rarity || '?'}</span>
                            </div>
                            <div class="mt-2 flex flex-wrap gap-1">
                                ${tagsHtml}
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }
 
        // 3. 自動產生標籤按鈕
        function generateTags() {
            const tags = new Set();
            allBalls.forEach(ball => {
                if(ball.Tags) ball.Tags.split(',').forEach(t => tags.add(t.trim()));
            });
 
            const tagContainer = document.getElementById('tagFilters');
            tagContainer.innerHTML = '';
           
            tags.forEach(tag => {
                if(!tag) return;
                const btn = document.createElement('button');
                btn.className = `block w-full text-left px-3 py-1 rounded hover:bg-gray-600 transition text-sm mb-1 ${activeTag === tag ? 'bg-blue-600' : 'bg-transparent'}`;
                btn.innerText = tag;
                btn.onclick = () => filterByTag(tag);
                tagContainer.appendChild(btn);
            });
        }
 
        // 4. 搜尋與過濾功能
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            filterData(term, activeTag);
        });
 
        function filterByTag(tag) {
            activeTag = (activeTag === tag) ? '' : tag; // 再次點擊取消
            generateTags(); // 重新渲染按鈕顏色
            filterData(searchInput.value.toLowerCase(), activeTag);
        }
 
        function filterData(searchTerm, tag) {
            const filtered = allBalls.filter(ball => {
                const matchName = ball.Name && ball.Name.toLowerCase().includes(searchTerm);
                const matchTag = tag ? (ball.Tags && ball.Tags.includes(tag)) : true;
                return matchName && matchTag;
            });
            renderCards(filtered);
        }
 
        function resetFilters() {
            searchInput.value = '';
            activeTag = '';
            generateTags();
            renderCards(allBalls);
        }
    </script>
</body>
</html>
